(function(global,factory){typeof exports=="object"&&typeof module!="undefined"?factory(exports):typeof define=="function"&&define.amd?define(["exports"],factory):factory(global.wna={})})(this,function(exports){"use strict";
/*!
 * Wna.js v0.1.0
 * (c) W Love Namie Amuro (mailto: avextk@me.com)
 * Released under the MIT License.
 */
function IsNullOrUndefined(v){return null===v||undefined===v}function IsFormData(v){if(!window.hasOwnProperty("FormData"))throw new UnsupportedTypeException("FormData");var type_str=_tostr.call(new FormData);return type_str===_tostr.call(v)}function IsFunction(v){var type_str=_tostr.call(_tostr);return type_str===_tostr.call(v)}function IsInteger(v){return v===parseInt(v,10)}function IsBoolean(v){var type_str=_tostr.call(!0);return type_str===_tostr.call(v)}function IsNumber(v){return!IsNullOrUndefined(v)&&!isNaN(v)}function IsString(v){var type_str=_tostr.call("w.love.namie");return type_str===_tostr.call(v)}function IsObject(v){var type_str=_tostr.call({});return type_str===_tostr.call(v)}function IsNullOrEmpty(v){return IsNullOrUndefined(v)?!0:IsString(v)?v.length<1:IsArray(v)?v.length<1:IsObject(v)?Object.keys(v).length<1:!1}function ValueIfNull(v,d){return IsNullOrUndefined(v)?d:v}function ValueIfEmpty(v,d){return IsNullOrEmpty(v)?d:v}function DefaultImplementationOf(v,f){return IsFunction(v)?v:f}function InvokeIfNotNull(func,...args){if(IsFunction(func))return func.call(...args)}function InvokeAsync(func,...args){return setTimeout(function(){func(...args)},1)}function NVL(a1,a2){return!0!==wna.IsNullOrEmpty(a1)?a1:a2}function NVL2(a1,a2,a3){return!0!==wna.IsNullOrEmpty(a1)?a2:a3}function IdSelector(id){return IsNullOrEmpty(id)?"":String.concat("#",id)}function ClassSelector(c){return IsNullOrEmpty(c)?"":String.concat(".",c)}function Debounce(func,time,immediate){return IsFunction(func)?IsNumber(time)?function(f,t,i){let _timer=null,_cb1=!0===i?f:function(){},_cb2=!0===i?function(){}:f;return function(){let caller=this,args=Array.from(arguments);IsNullOrUndefined(_timer)&&_cb1.apply(caller,args);clearTimeout(_timer);_timer=null,function(c,ag){_timer=setTimeout(function(){_cb2.apply(c,ag);clearTimeout(_timer);_timer=null},t)}(caller,args)}}(func,time,immediate):null:null}function Throttle(func,time,immediate){return IsFunction(func)?IsNumber(time)?function(f,t,i){let _timer=null,_cb1=!0===i?f:function(){},_cb2=!0===i?function(){}:f;return function(){let caller=this,args=Array.from(arguments);IsNullOrUndefined(_timer)&&(_cb1.apply(caller,args),function(c,ag){_timer=setTimeout(function(){_cb2.apply(c,ag);clearTimeout(_timer);_timer=null},t)}(caller,args))}}(func,time,immediate):null:null}let _tostr=Object.prototype.toString;var IsArray=IsNullOrUndefined(Array.isArray)?function(t){var type_str=_tostr.call([]);return type_str===_tostr.call(t)}:Array.isArray;const InvalidState="InvalidStateException",TypeMismatch="TypeMismatchException",NullArgument="NullArgumentException",NullReference="NullReferenceException",AlreadyExists="AlreadyExistsException",TooFewArguments="TooFewArgumentsException",InvalidArgument="InvalidArgumentException",IndexOutOfRange="IndexOutOfRangeException",UnsupportedType="UnsupportedTypeException",InvalidOperation="InvalidOperationException",UnhandledRejection="UnhandledRejectionException";class Exception extends Error{constructor(message,type,subject,innerException,...context){super((IsNullOrUndefined(type)?"[general]":`[${type}]`)+(IsNullOrUndefined(subject)?"":`[${subject}]`)+` - ${message}`);Object.defineProperties(this,{_type:{value:type,writable:!1,enumerable:!1},_subject:{value:subject,writable:!1,enumerable:!1},_userMessage:{value:message,writable:!1,enumerable:!1},_innerException:{value:innerException,writable:!1,enumerable:!1},_context:{value:context,writable:!1,enumerable:!1},type:{configurable:!1,get:function(){return this._type}},subject:{configurable:!1,get:function(){return this._subject}},context:{configurable:!1,get:function(){return this._context}},userMessage:{configurable:!1,get:function(){return this._userMessage}},innerException:{configurable:!1,get:function(){return this._innerException}}})}}class InvalidStateException extends Exception{constructor(message,subject,innerException,...context){super(message,InvalidState,subject,innerException,...context)}}class TypeMismatchException extends Exception{constructor(message,subject,innerException,...context){super(message,TypeMismatch,subject,innerException,...context)}}class NullArgumentException extends Exception{constructor(message,subject,innerException,...context){super(message,NullArgument,subject,innerException,...context)}}class NullReferenceException extends Exception{constructor(message,subject,innerException,...context){super(message,NullReference,subject,innerException,...context)}}class AlreadyExistsException$1 extends Exception{constructor(message,subject,innerException,...context){super(message,AlreadyExists,subject,innerException,...context)}}class InvalidArgumentException extends Exception{constructor(message,subject,innerException,...context){super(message,InvalidArgument,subject,innerException,...context)}}class IndexOutOfRangeException extends Exception{constructor(message,subject,innerException,...context){super(message,IndexOutOfRange,subject,innerException,...context)}}class UnsupportedTypeException$1 extends Exception{constructor(message,subject,innerException,...context){super(message,UnsupportedType,subject,innerException,...context)}}class UnhandledRejectionException extends Exception{constructor(message,subject,innerException,...context){super(message,UnhandledRejection,subject,innerException,...context)}}class TooFewArgumentsException extends Exception{constructor(message,subject,innerException,...context){super(message,TooFewArguments,subject,innerException,...context)}}class InvalidOperationException extends Exception{constructor(message,subject,innerException,...context){super(message,InvalidOperation,subject,innerException,...context)}}let _casing=function(a,b,ignoreCase){return!0===ignoreCase?[a.toLowerCase(),b.toLowerCase()]:[a,b]};String.prototype.contains=function(n,ignoreCase){if(IsNullOrEmpty(n))return!1;let[a,b]=_casing(this,n,ignoreCase);return a.indexOf(b)>=0};String.prototype.containsAny=function(){if(arguments.length<1)return!1;let last=arguments.length-1,needles=Array.from(arguments),ignoreCase=!0===arguments[last]&&last>0;IsBoolean(arguments[last])&&needles.splice(last,1);for(var needle of needles)if(this.contains(needle,ignoreCase))return!0;return!1};String.prototype.containsAll=function(){if(arguments.length<1)return!1;let last=arguments.length-1,needles=Array.from(arguments),ignoreCase=!0===arguments[last]&&last>0;IsBoolean(arguments[last])&&needles.splice(last,1);for(var needle of needles)if(!this.contains(needle,ignoreCase))return!1;return!0};String.prototype.endsWith=function(n,ignoreCase){if(IsNullOrEmpty(n))return!1;let[a,b]=_casing(this,n,ignoreCase);return a.length-b.length===a.lastIndexOf(b)};String.prototype.startsWith=function(n,ignoreCase){if(IsNullOrEmpty(n))return!1;let[a,b]=_casing(this,n,ignoreCase);return 0===a.indexOf(b,0)};String.prototype.existsIn=function(s,ignoreCase){return IsNullOrUndefined(s)?!1:s.contains(this,ignoreCase)};String.prototype.isHeadOf=function(s,ignoreCase){return IsNullOrUndefined(s)?!1:s.startsWith(this,ignoreCase)};String.prototype.isTailOf=function(s,ignoreCase){return IsNullOrUndefined(s)?!1:s.endsWith(this,ignoreCase)};String.prototype.indexAfter=function(n,ignoreCase,k){if(IsNullOrEmpty(n))return-1;let[a,b]=_casing(this,n,ignoreCase),i=-1;if(k=IsNullOrUndefined(k)?0:k,k<0){do{var x=i<0?a:a.substr(0,i);i=x.lastIndexOf(b)}while(i>=0&&++k<0)}else do i=a.indexOf(b,i+1);while(i>=0&&--k>=0);return i>=0?i+b.length:i};String.prototype.substrAfterLast=function(needle){if(IsNullOrEmpty(needle))return null;var index=this.lastIndexOf(needle),nnlen=needle.length;return index>=0?this.substr(index+nnlen,this.length-index-nnlen):null};String.prototype.substrAfter=function(n,ignoreCase,k){let i=this.indexAfter(n,ignoreCase,k);return i<0?undefined:this.substr(i)};String.prototype.substrBeforeLast=function(needle){if(IsNullOrEmpty(needle))return null;var index=this.lastIndexOf(needle);return index>0?this.substr(0,index):null};String.prototype.substrBefore=function(needle,fromIndex){if(IsNullOrEmpty(needle))return null;var index=this.indexOf(needle,fromIndex);return index>0?this.substr(0,index):null};String.prototype.substrBetween=function(start,end){if(IsNullOrEmpty(start))return this.substrBefore(end);if(IsNullOrEmpty(end))return this.substrAfter(start);var index1=this.indexOf(start)+start.length,index2=this.indexOf(end,index1);return index1>=0&&index2>=index1?this.substring(index1,index2):null};String.prototype.toFirstCapital=function(){if(IsNullOrEmpty(this))return this;let s=this.toLowerCase();return s[0].toUpperCase()+s.slice(1)};String.capitalFirstCharacter=function(s){return IsNullOrEmpty(s)?s:s.toFirstCapital()};String.prefixIfNotEmpty=function(s,n){return IsNullOrEmpty(s)?s:IsNullOrEmpty(n)?s:n+""+s};String.suffixIfNotEmpty=function(s,n){return IsNullOrEmpty(s)?s:IsNullOrEmpty(n)?s:s+""+n};String.toLowerIfNotEmpty=function(s){return IsNullOrEmpty(s)?s:s.toLowerCase()};String.toUpperIfNotEmpty=function(s){return IsNullOrEmpty(s)?s:s.toUpperCase()};String.trimIfNotEmpty=function(s){return IsNullOrEmpty(s)?s:s.trim()};String.trimAndLowerIfNotEmpty=function(s){return IsNullOrEmpty(s)?s:s.trim().toLowerCase()};String.trimAndUpperIfNotEmpty=function(s){return IsNullOrEmpty(s)?s:s.trim().toUpperCase()};String.concat=function(...strs){return IsNullOrUndefined(strs)?null:IsNullOrEmpty(strs)?"":Array.prototype.join.call(strs,"")};String.UUID=function(){var dt=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(dt+Math.random()*16)%16|0;return dt=Math.floor(dt/16),(c==="x"?r:r&3|8).toString(16)})};Function.Signature=function(...args){let typs=[];for(var a of args)IsNullOrUndefined(a)?typs.push("null"):typs.push((typeof a).toLowerCase());let sig=null;return IsNullOrEmpty(typs)||(sig=Array.prototype.join.call(typs,",")),IsNullOrEmpty(sig)?"-":sig};Function.Overload=function(variants,_default){if(IsNullOrUndefined(variants))return undefined;let _ovloads={};for(var sig in variants){let fnc=variants[sig],pcs,key;if(IsFunction(fnc)){if(IsNullOrEmpty(sig)||(pcs=sig.split(",").map(v=>String.trimAndLowerIfNotEmpty(v))),key=IsNullOrEmpty(pcs)?"-":pcs.join(","),!IsNullOrUndefined(_ovloads[key]))throw new AlreadyExistsException(`Function signature: ${sig}`);_ovloads[key]=fnc}}return function(overloads,defaultImpl){return function(...args){var sig,vsig,i;let caller=this,callsignature=Function.Signature.apply(caller,args),impl=overloads[callsignature];if(IsNullOrUndefined(impl)&&callsignature.contains("null")){let sigregex=new RegExp(String.prototype.replace.call(callsignature,/null/g,"((string)|(object)|(null)|(undefined))"));for(sig in overloads){let matches=sig.match(sigregex);if(!IsNullOrEmpty(matches)){impl=overloads[matches[0]];break}}}if(IsNullOrUndefined(impl))for(vsig in overloads)if(vsig.contains("*")){let found=!0,vpcs=vsig.split(","),cpcs=callsignature.split(",");if(vpcs.length!==cpcs.length)continue;for(i=0;i<cpcs.length;i++)if("*"!==vpcs[i]){let c=cpcs[i].trim().toLowerCase();if(c!==vpcs[i]){found=!1;break}}if(found){impl=overloads[vsig];break}}return IsFunction(impl)?impl.apply(caller,args):IsFunction(defaultImpl)?defaultImpl.apply(caller,args):void 0}}(_ovloads,_default)};IsNullOrUndefined(window.jQuery)||function($){$.event.special.livechange={setup:function(){var $this=$(this);$this.on("keydown",Debounce(function(ev){var $target=$(ev.target);$target.trigger("livechange")},370))}};$.fn.extend({overflowX:function(bias){bias=IsNumber(bias)?bias:0;let $this=this.first(),contentWidth=$this.prop("scrollWidth"),viewportWidth=$this.innerWidth();return contentWidth-viewportWidth>3},overflowY:function(bias){bias=IsNumber(bias)?bias:0;let $this=this.first(),contentHeight=$this.prop("scrollHeight"),viewportHeight=$this.innerHeight();return contentHeight-viewportHeight>3},overflow:function(bias){let $this=this.first();return $this.overflowX(bias)||$this.overflowY(bias)},scrollReachBottom:function(bias){let $this=this.first(),scrolltop=$this.scrollTop(),contentHeight=$this.prop("scrollHeight"),viewportHeight=$this.innerHeight();return contentHeight-(scrolltop+viewportHeight)<=bias},fire:function(eventname,details,bubble){if(!IsNullOrEmpty(eventname)){var ev=new CustomEvent(eventname,{detail:details,bubbles:IsNullOrUndefined(bubble)?!0:bubble,cancelable:!0});this.each(function(){this.dispatchEvent(ev)})}}})}(window.jQuery);exports.Exception=Exception;exports.InvalidStateException=InvalidStateException;exports.TypeMismatchException=TypeMismatchException;exports.NullArgumentException=NullArgumentException;exports.NullReferenceException=NullReferenceException;exports.AlreadyExistsException=AlreadyExistsException$1;exports.InvalidArgumentException=InvalidArgumentException;exports.IndexOutOfRangeException=IndexOutOfRangeException;exports.UnsupportedTypeException=UnsupportedTypeException$1;exports.UnhandledRejectionException=UnhandledRejectionException;exports.TooFewArgumentsException=TooFewArgumentsException;exports.InvalidOperationException=InvalidOperationException;exports.IsNullOrUndefined=IsNullOrUndefined;exports.IsArray=IsArray;exports.IsFormData=IsFormData;exports.IsFunction=IsFunction;exports.IsInteger=IsInteger;exports.IsBoolean=IsBoolean;exports.IsNumber=IsNumber;exports.IsString=IsString;exports.IsObject=IsObject;exports.IsNullOrEmpty=IsNullOrEmpty;exports.ValueIfNull=ValueIfNull;exports.ValueIfEmpty=ValueIfEmpty;exports.DefaultImplementationOf=DefaultImplementationOf;exports.InvokeIfNotNull=InvokeIfNotNull;exports.InvokeAsync=InvokeAsync;exports.NVL=NVL;exports.NVL2=NVL2;exports.IdSelector=IdSelector;exports.ClassSelector=ClassSelector;exports.Debounce=Debounce;exports.Throttle=Throttle;Object.defineProperty(exports,"__esModule",{value:!0})});
/*!
* jQuery plugin that provides the real activity monitoring for ajax-based single-page web application
* v0.1.1 Part of the WJX Framework.
* (C) www.i2sq.com   by avextk@gmail.com FEB-2012
*/
(function($,wxplugin){var defaults={ping_url:"",inactive:"20sec",countdown:"5sec"},event_name_idle="Idle.wxActivityMonitor",event_name_gone="Gone.wxActivityMonitor",event_name_back="Back.wxActivityMonitor",last_useractivity=null,last_ajaxactivity=null,timer1=null,timer2=null,sending_keepalive=!1,triggerBackIfNecessary=function(opts){!wna.IsNullOrUndefined(timer1)||wna.IsNullOrUndefined(timer2)||(clearTimeout(timer2),timer2=null,timer1=setTimeout(timer1_handler,opts.inactive,opts,opts.$elements),wna.IsNullOrUndefined(opts.$elements)||opts.$elements.trigger(event_name_back))},userevent_handler=function(ev){last_useractivity=Date.now();!0!==wna.IsNullOrEmpty(ev.data.ping_url)&&last_useractivity-last_ajaxactivity>ev.data._countdown&&!0!==sending_keepalive&&(sending_keepalive=!0,$.get(ev.data.ping_url,function(){sending_keepalive=!1}));triggerBackIfNecessary(ev.data)},ajaxevent_handler=function(ev){last_ajaxactivity=Date.now();triggerBackIfNecessary(ev.data)},timer1_handler=function(options,$elements){var now=Date.now(),last=last_ajaxactivity>last_useractivity?last_ajaxactivity:last_useractivity,newtimeout;now-last>options._inactive?(timer1=null,timer2=setTimeout(timer2_handler,options._countdown,options,$elements),$elements.trigger(event_name_idle)):(!0!==wna.IsNullOrUndefined(timer2)&&(clearTimeout(timer2),timer2=null),newtimeout=last+options._inactive-now,timer1=setTimeout(timer1_handler,newtimeout,options,$elements))},timer2_handler=function(options,$elements){var now=Date.now(),last=last_ajaxactivity>last_useractivity?last_ajaxactivity:last_useractivity,newtimeout;now-last>options._countdown+options._inactive?(!0!==wna.IsNullOrUndefined(timer1)&&(clearTimeout(timer1),timer1=null),!0!==wna.IsNullOrUndefined(timer2)&&(clearTimeout(timer2),timer2=null),$elements.trigger(event_name_gone)):(newtimeout=last+options._inactive-now,timer2=null,timer1=setTimeout(timer1_handler,newtimeout,options,$elements))},methods={init:function(options){var _opt=$.extend(!0,{},defaults,options),inactive=_opt.inactive.toLowerCase(),countdown=_opt.countdown.toLowerCase();if(inactive.endsWith("sec"))inactive=parseFloat(inactive.substrBefore("sec"))*1e3;else if(inactive.endsWith("min"))inactive=parseFloat(inactive.substrBefore("min"))*6e4;else throw'Option "inactive" MUST be in unit of "sec" or "min"';if(countdown.endsWith("sec"))countdown=parseFloat(countdown.substrBefore("sec"))*1e3;else if(countdown.endsWith("min"))countdown=parseFloat(countdown.substrBefore("min"))*6e4;else throw'Option "countdown" MUST be in unit of "sec" or "min"';return _opt.$elements=this,_opt._inactive=inactive,_opt._countdown=countdown,this.data(wxplugin+".options",_opt),this},start:function(){var now=Date.now(),_opt=this.data(wxplugin+".options"),inactive=_opt._inactive;last_useractivity=now;last_ajaxactivity=now;$(window).on("mousemove keydown",_opt,userevent_handler);$(document).on("ajaxSuccess",_opt,ajaxevent_handler);return timer1=setTimeout(timer1_handler,inactive,_opt,this),this},stop:function(){return!0!==wna.IsNullOrUndefined(timer1)&&(clearTimeout(timer1),timer1=null),!0!==wna.IsNullOrUndefined(timer2)&&(clearTimeout(timer2),timer2=null),$(window).off("mousemove keydown",userevent_handler),$(document).off("ajaxSuccess",ajaxevent_handler),this},destroy:function(){},bindIdle:function(callback,user_data){return this.on(event_name_idle,user_data,callback)},unbindIdle:function(callback){return this.off(event_name_idle,callback)},bindGone:function(callback,user_data){return this.on(event_name_gone,user_data,callback)},unbindGone:function(callback){return this.off(event_name_gone,callback)},bindBack:function(callback,user_data){return this.on(event_name_back,user_data,callback)},unbindBack:function(callback){return this.off(event_name_back,callback)}};$.fn[wxplugin]=function(method){if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));if(typeof method!="object"&&null!==methods[method]&&method)$.error("Method "+method+" does not exist on jQuery."+wxplugin);else return methods.init.apply(this,arguments)}})(jQuery,"wxactivity");var InitBlockUI=null;(function(){var scheduledBlockUI=null,outstanding_ajaxs=0;InitBlockUI=function(captionProvider){$(document).ajaxSend(function(event,jqXHR,ajaxopts){(!0!==ajaxopts.hasOwnProperty("url")||!0!==ajaxopts.url.endsWith("/listen"))&&(outstanding_ajaxs++,wna.IsNullOrUndefined(scheduledBlockUI)&&(scheduledBlockUI=setTimeout(function(){$.blockUI({css:{background:"transparent",color:"#FFFFFF",border:"none"},overlayCSS:{opacity:.58},message:`<div class='icon-loading'></div>&nbsp;&nbsp;${captionProvider()}...`})},400)))});$(document).ajaxComplete(function(event,jqXHR,ajaxopts){(!0!==ajaxopts.hasOwnProperty("url")||!0!==ajaxopts.url.endsWith("/listen"))&&(outstanding_ajaxs=--outstanding_ajaxs<0?0:outstanding_ajaxs,0===outstanding_ajaxs&&(wna.IsNullOrUndefined(scheduledBlockUI)||(clearTimeout(scheduledBlockUI),scheduledBlockUI=null),$.unblockUI()))});$(document).ajaxError(function(event,jqXHR){if(wna.IsNullOrUndefined(jqXHR)){console.log("BlockUI got ajaxError: ",event,jqXHR);var ok=confirm("Connection Error: "+event+"\n\r"+jqXHR.responseText);!ok||$.unblockUI()}else switch(jqXHR.status){case 401:case 403:case 410:case 499:$.blockUI({css:{background:"transparent",color:"#FFFFFF",border:"none"},overlayCSS:{opacity:.58},message:"<div class='icon-loading'><\/div>&nbsp;&nbsp;"});$(window).trigger("Gone.wxActivityMonitor")}})}})();